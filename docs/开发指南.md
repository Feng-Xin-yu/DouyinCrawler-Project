# 开发指南

本指南面向想要理解项目架构和开发流程的开发者。

## 项目架构

### 整体架构

```
DouyinCrawler/
├── main.py                    # 程序入口
├── config/                    # 配置管理
├── base/                      # 抽象基类
├── constant/                  # 常量定义
├── douyin/                    # 抖音爬虫实现
│   ├── client.py             # HTTP客户端
│   ├── core.py               # 爬虫核心
│   ├── extractor.py          # 数据提取器
│   ├── handlers/            # 处理器
│   └── processors/          # 数据处理器
├── pkg/                      # 工具包
│   ├── account_pool/        # 账号池
│   ├── proxy/               # 代理IP池
│   ├── cache/               # 缓存系统
│   ├── sign/                # 签名模块
│   ├── js/                  # JavaScript签名代码
│   └── tools/               # 工具函数
├── repo/                     # 数据存储层
│   └── platform_save_data/  # 平台数据存储
└── model/                    # 数据模型
```

## 核心概念

### 1. 数据流转

```
用户输入 → 配置解析 → 创建爬虫 → 初始化（账号池、代理池） → 
选择Handler → 调用API → 数据提取 → 数据处理 → 数据存储
```

### 2. 关键组件

- **Client（客户端）**：负责发送HTTP请求，处理签名、账号、代理
- **Handler（处理器）**：处理不同类型的爬取任务（搜索/详情/创作者/首页）
- **Processor（数据处理器）**：处理爬取到的数据，调用存储层保存
- **Extractor（提取器）**：从API响应中提取结构化数据
- **Store（存储层）**：将数据保存到CSV/JSON文件

### 3. 设计模式

- **工厂模式**：CrawlerFactory创建爬虫实例
- **抽象基类**：AbstractCrawler、AbstractStore等
- **依赖注入**：通过构造函数注入依赖
- **策略模式**：不同的存储策略（CSV/JSON）

## 调试技巧

1. **添加日志**：在关键位置添加`utils.logger.info()`
2. **打印数据**：在extractor中打印提取的数据，验证提取逻辑
3. **单步调试**：使用调试器逐步执行代码
4. **查看API响应**：在client.py中打印API响应，理解数据结构

## 扩展开发

### 添加新的爬取类型

1. 在 `douyin/handlers/` 中创建新的 Handler
2. 继承 `BaseHandler` 基类
3. 在 `douyin/core.py` 中注册新的 Handler
4. 在 `constant/base_constant.py` 中添加新的爬取类型常量

### 添加新的存储方式

1. 在 `repo/platform_save_data/douyin/` 中实现新的存储类
2. 继承 `AbstractStore` 基类
3. 在 `DouyinStoreFactory` 中注册新的存储类型
